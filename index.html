<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Decision Visualizer - AI-Powered Decision Making</title>
  <meta name="description" content="Transform complex life decisions into interactive 3D visualizations with AI guidance">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Framer Motion -->
  <script src="https://unpkg.com/framer-motion@10/dist/framer-motion.js"></script>
  
  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }
    
    #root {
      width: 100vw;
      height: 100vh;
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(139, 92, 246, 0.5);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(139, 92, 246, 0.7);
    }

    /* Loading animation */
    .loader {
      border: 4px solid rgba(139, 92, 246, 0.1);
      border-radius: 50%;
      border-top: 4px solid #8b5cf6;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="root">
    <div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: linear-gradient(135deg, #1e293b 0%, #7e22ce 50%, #1e293b 100%);">
      <div class="loader"></div>
    </div>
  </div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const { motion, AnimatePresence } = Motion;

    const DecisionVisualizer = () => {
      const [mainQuestion, setMainQuestion] = useState('');
      const [isSetup, setIsSetup] = useState(false);
      const [values, setValues] = useState([
        { id: 1, name: 'Financial Security', weight: 0.5, color: '#10b981' },
        { id: 2, name: 'Personal Growth', weight: 0.5, color: '#3b82f6' },
        { id: 3, name: 'Family Time', weight: 0.5, color: '#ec4899' },
        { id: 4, name: 'Adventure', weight: 0.5, color: '#f59e0b' },
        { id: 5, name: 'Stability', weight: 0.5, color: '#8b5cf6' },
      ]);
      const [branches, setBranches] = useState([]);
      const [selectedBranch, setSelectedBranch] = useState(null);
      const [messages, setMessages] = useState([]);
      const [inputMessage, setInputMessage] = useState('');
      const [isAiThinking, setIsAiThinking] = useState(false);
      const [showChat, setShowChat] = useState(false);
      const [timelinePosition, setTimelinePosition] = useState(1);
      const canvasRef = useRef(null);
      const chatEndRef = useRef(null);
      const [isMobile, setIsMobile] = useState(false);

      useEffect(() => {
        setIsMobile(window.innerWidth < 768);
        const handleResize = () => setIsMobile(window.innerWidth < 768);
        window.addEventListener('resize', handleResize);
        return () => window.removeEventListener('resize', handleResize);
      }, []);

      useEffect(() => {
        if (!isSetup) return;
        
        const canvas = canvasRef.current;
        if (!canvas) return;

        const ctx = canvas.getContext('2d');
        const updateCanvas = () => {
          canvas.width = canvas.offsetWidth * window.devicePixelRatio;
          canvas.height = canvas.offsetHeight * window.devicePixelRatio;
          ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
        };
        updateCanvas();
        window.addEventListener('resize', updateCanvas);

        let animationFrame;
        let time = 0;
        const particles = [];
        
        for (let i = 0; i < 100; i++) {
          particles.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            vx: (Math.random() - 0.5) * 0.5,
            vy: (Math.random() - 0.5) * 0.5,
            size: Math.random() * 2 + 1
          });
        }

        const drawDecisionTree = () => {
          ctx.clearRect(0, 0, canvas.offsetWidth, canvas.offsetHeight);
          
          particles.forEach(p => {
            ctx.fillStyle = `rgba(139, 92, 246, ${0.3 + Math.sin(time * 0.001 + p.x) * 0.2})`;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            ctx.fill();
            
            p.x += p.vx;
            p.y += p.vy;
            
            if (p.x < 0 || p.x > canvas.offsetWidth) p.vx *= -1;
            if (p.y < 0 || p.y > canvas.offsetHeight) p.vy *= -1;
          });

          if (branches.length === 0) return;

          const centerX = canvas.offsetWidth / 2;
          const centerY = isMobile ? canvas.offsetHeight / 3 : canvas.offsetHeight / 2;
          const radius = isMobile ? 80 : 120;

          const pulse = Math.sin(time * 0.002) * 10;
          const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, 40 + pulse);
          gradient.addColorStop(0, '#8b5cf6');
          gradient.addColorStop(1, '#6366f1');
          
          ctx.fillStyle = gradient;
          ctx.shadowBlur = 20 + pulse;
          ctx.shadowColor = '#8b5cf6';
          ctx.beginPath();
          ctx.arc(centerX, centerY, 35 + pulse / 2, 0, Math.PI * 2);
          ctx.fill();
          ctx.shadowBlur = 0;

          branches.forEach((branch, i) => {
            const angle = (Math.PI * 2 * i) / branches.length - Math.PI / 2;
            const x = centerX + Math.cos(angle) * radius;
            const y = centerY + Math.sin(angle) * radius;

            const alignment = calculateAlignment(branch);
            const color = alignment > 0.6 ? '#10b981' : alignment > 0.4 ? '#f59e0b' : '#ef4444';

            const flowOffset = (time * 0.003) % 1;
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.setLineDash([10, 10]);
            ctx.lineDashOffset = -flowOffset * 20;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.setLineDash([]);

            const nodeSize = 25 + alignment * 15;
            const nodeGradient = ctx.createRadialGradient(x, y, 0, x, y, nodeSize);
            nodeGradient.addColorStop(0, color);
            nodeGradient.addColorStop(1, color + '88');
            
            ctx.fillStyle = nodeGradient;
            ctx.shadowBlur = 15;
            ctx.shadowColor = color;
            ctx.beginPath();
            ctx.arc(x, y, nodeSize, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;

            if (branch.probability < 0.8) {
              const cloudSize = (1 - branch.probability) * 30;
              for (let j = 0; j < 20; j++) {
                const cloudX = x + (Math.random() - 0.5) * cloudSize;
                const cloudY = y + (Math.random() - 0.5) * cloudSize;
                ctx.fillStyle = `rgba(239, 68, 68, ${0.1 + Math.sin(time * 0.002 + j) * 0.1})`;
                ctx.beginPath();
                ctx.arc(cloudX, cloudY, 2, 0, Math.PI * 2);
                ctx.fill();
              }
            }

            ctx.fillStyle = '#fff';
            ctx.font = isMobile ? '11px sans-serif' : '13px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(
              branch.title.length > 20 ? branch.title.substring(0, 20) + '...' : branch.title,
              x,
              y + nodeSize + 20
            );
          });

          time++;
          animationFrame = requestAnimationFrame(drawDecisionTree);
        };

        drawDecisionTree();

        return () => {
          cancelAnimationFrame(animationFrame);
          window.removeEventListener('resize', updateCanvas);
        };
      }, [branches, isSetup, isMobile]);

      const calculateAlignment = (branch) => {
        if (!branch.valueScores) return 0.5;
        let totalScore = 0;
        let totalWeight = 0;
        
        values.forEach(value => {
          const score = branch.valueScores[value.name] || 0.5;
          totalScore += score * value.weight;
          totalWeight += value.weight;
        });
        
        return totalWeight > 0 ? totalScore / totalWeight : 0.5;
      };

      const startDecision = () => {
        if (!mainQuestion.trim()) return;
        setIsSetup(true);
        setMessages([{
          role: 'assistant',
          content: `Great! Let's explore: "${mainQuestion}". I'll help you think through this decision. What are your main options?`
        }]);
        setShowChat(true);
      };

      const sendMessage = async () => {
        if (!inputMessage.trim()) return;

        const userMsg = { role: 'user', content: inputMessage };
        setMessages(prev => [...prev, userMsg]);
        setInputMessage('');
        setIsAiThinking(true);

        try {
          const response = await fetch('https://api.anthropic.com/v1/messages', {
  method: 'POST',
  headers: { 
    'Content-Type': 'application/json',
    'x-api-key': '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',  // ← ADD THIS LINE
    'anthropic-version': '2023-06-01'          // ← ADD THIS LINE
  },
            body: JSON.stringify({
              model: 'claude-sonnet-4-20250514',
              max_tokens: 1000,
              messages: [...messages, userMsg].map(m => ({
                role: m.role === 'assistant' ? 'assistant' : 'user',
                content: m.content
              })),
              system: `You're a decision-making coach helping someone explore: "${mainQuestion}".

Current decision branches: ${JSON.stringify(branches)}
Their values: ${values.map(v => `${v.name} (weight: ${v.weight})`).join(', ')}

Your role:
1. Ask insightful questions to uncover what matters
2. Suggest decision branches they haven't considered
3. Help estimate probabilities realistically
4. Challenge assumptions gently
5. When suggesting branches, use this format:

BRANCH: [Title]
OUTCOMES: [outcome1], [outcome2], [outcome3]
PROBABILITY: [0.0-1.0]
VALUES: Financial Security: [0.0-1.0], Personal Growth: [0.0-1.0], Family Time: [0.0-1.0], Adventure: [0.0-1.0], Stability: [0.0-1.0]

Be concise, warm, and thought-provoking.`
            })
          });

          const data = await response.json();
          const aiResponse = data.content[0].text;
          
          setMessages(prev => [...prev, { role: 'assistant', content: aiResponse }]);
          
          const branchMatches = aiResponse.matchAll(/BRANCH: (.*?)\nOUTCOMES: (.*?)\nPROBABILITY: (.*?)\nVALUES: (.*?)(?=\n|$)/gs);
          
          for (const match of branchMatches) {
            const [_, title, outcomes, probability, valueScoresStr] = match;
            const valueScores = {};
            
            valueScoresStr.split(',').forEach(pair => {
              const [key, val] = pair.split(':').map(s => s.trim());
              valueScores[key] = parseFloat(val) || 0.5;
            });
            
            const newBranch = {
              id: Date.now() + Math.random(),
              title: title.trim(),
              outcomes: outcomes.split(',').map(o => o.trim()),
              probability: parseFloat(probability) || 0.7,
              valueScores
            };
            
            setBranches(prev => [...prev, newBranch]);
          }
          
        } catch (error) {
          setMessages(prev => [...prev, { 
            role: 'assistant', 
            content: 'I had trouble connecting. But let me help you think through this - what options are you considering?' 
          }]);
        }

        setIsAiThinking(false);
      };

      useEffect(() => {
        chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      }, [messages]);

      const addCustomBranch = () => {
        const title = prompt('What\'s this option called?');
        if (!title) return;
        
        const newBranch = {
          id: Date.now(),
          title,
          outcomes: ['Outcome to explore'],
          probability: 0.7,
          valueScores: Object.fromEntries(values.map(v => [v.name, 0.5]))
        };
        
        setBranches(prev => [...prev, newBranch]);
      };

      if (!isSetup) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-4">
            <motion.div
              initial={{ scale: 0.9, opacity: 0 }}
              animate={{ scale: 1, opacity: 1 }}
              transition={{ duration: 0.5 }}
              className="max-w-2xl w-full"
            >
              <div className="text-center mb-8">
                <motion.h1
                  className="text-5xl md:text-7xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 via-pink-400 to-blue-400 mb-4"
                  animate={{ 
                    backgroundPosition: ['0% 50%', '100% 50%', '0% 50%'],
                  }}
                  transition={{ duration: 5, repeat: Infinity }}
                  style={{ backgroundSize: '200% 200%' }}
                >
                  Decision Visualizer
                </motion.h1>
                <p className="text-purple-200 text-lg md:text-xl">
                  Transform complex decisions into visual clarity
                </p>
              </div>

              <motion.div
                initial={{ y: 20, opacity: 0 }}
                animate={{ y: 0, opacity: 1 }}
                transition={{ delay: 0.2 }}
                className="bg-white/10 backdrop-blur-xl rounded-3xl p-6 md:p-8 border border-white/20 shadow-2xl"
              >
                <label className="block text-purple-100 text-sm font-medium mb-3">
                  What decision are you facing?
                </label>
                <input
                  type="text"
                  value={mainQuestion}
                  onChange={(e) => setMainQuestion(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && startDecision()}
                  placeholder="e.g., Should I accept the job offer in another city?"
                  className="w-full px-4 py-4 bg-white/5 border border-white/20 rounded-xl text-white placeholder-purple-300/50 focus:outline-none focus:border-purple-400 focus:ring-2 focus:ring-purple-400/50 transition-all text-base md:text-lg"
                />
                
                <motion.button
                  onClick={startDecision}
                  whileHover={{ scale: 1.02 }}
                  whileTap={{ scale: 0.98 }}
                  className="w-full mt-6 px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-semibold text-lg shadow-lg hover:shadow-purple-500/50 transition-all"
                >
                  Start Exploring →
                </motion.button>

                <div className="mt-8 grid grid-cols-2 md:grid-cols-3 gap-3">
                  {['Career Change', 'Moving Cities', 'Starting Business', 'Education', 'Relationships', 'Investment'].map((example, i) => (
                    <motion.button
                      key={example}
                      initial={{ opacity: 0, y: 10 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ delay: 0.3 + i * 0.05 }}
                      onClick={() => setMainQuestion(`Should I ${example.toLowerCase()}?`)}
                      className="px-3 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-purple-200 text-xs md:text-sm transition-all"
                    >
                      {example}
                    </motion.button>
                  ))}
                </div>
              </motion.div>

              <motion.p
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                transition={{ delay: 0.5 }}
                className="text-center text-purple-300/60 text-sm mt-6"
              >
                AI-powered • 3D Visualization • Save & Share
              </motion.p>
            </motion.div>
          </div>
        );
      }

      return (
        <div className="h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 overflow-hidden flex flex-col">
          <div className="bg-black/20 backdrop-blur-xl border-b border-white/10 px-4 py-3">
            <div className="flex items-center justify-between max-w-7xl mx-auto">
              <div className="flex-1 min-w-0">
                <h2 className="text-white font-semibold truncate text-sm md:text-base">{mainQuestion}</h2>
                <p className="text-purple-300 text-xs md:text-sm">
                  {branches.length} option{branches.length !== 1 ? 's' : ''} • Timeline: {timelinePosition} year{timelinePosition !== 1 ? 's' : ''}
                </p>
              </div>
              <button
                onClick={() => setShowChat(!showChat)}
                className="ml-4 px-3 py-2 md:px-4 md:py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg text-xs md:text-sm font-medium transition-all"
              >
                {showChat ? 'Hide' : 'Show'} AI Chat
              </button>
            </div>
          </div>

          <div className="flex-1 flex flex-col md:flex-row overflow-hidden">
            <motion.div
              initial={{ x: -300, opacity: 0 }}
              animate={{ x: 0, opacity: 1 }}
              className="w-full md:w-72 bg-black/20 backdrop-blur-xl border-r border-white/10 p-4 overflow-y-auto"
            >
              <h3 className="text-white font-semibold mb-4 text-sm md:text-base">Your Values</h3>
              <div className="space-y-4">
                {values.map((value) => (
                  <div key={value.id}>
                    <div className="flex justify-between mb-2">
                      <span className="text-purple-200 text-xs md:text-sm">{value.name}</span>
                      <span className="text-purple-400 font-mono text-xs">{Math.round(value.weight * 100)}%</span>
                    </div>
                    <input
                      type="range"
                      min="0"
                      max="1"
                      step="0.01"
                      value={value.weight}
                      onChange={(e) => {
                        setValues(values.map(v =>
                          v.id === value.id ? { ...v, weight: parseFloat(e.target.value) } : v
                        ));
                      }}
                      className="w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer accent-purple-500"
                      style={{
                        background: `linear-gradient(to right, ${value.color} ${value.weight * 100}%, rgba(255,255,255,0.1) ${value.weight * 100}%)`
                      }}
                    />
                  </div>
                ))}
              </div>

              <div className="mt-6 pt-6 border-t border-white/10">
                <h3 className="text-white font-semibold mb-3 text-sm md:text-base">Timeline</h3>
                <div className="flex items-center space-x-2">
                  {[1, 2, 5, 10].map(year => (
                    <button
                      key={year}
                      onClick={() => setTimelinePosition(year)}
                      className={`flex-1 px-2 py-2 rounded-lg text-xs font-medium transition-all ${
                        timelinePosition === year
                          ? 'bg-purple-500 text-white'
                          : 'bg-white/5 text-purple-300 hover:bg-white/10'
                      }`}
                    >
                      {year}y
                    </button>
                  ))}
                </div>
              </div>
            </motion.div>

            <div className="flex-1 relative">
              <canvas
                ref={canvasRef}
                className="w-full h-full cursor-pointer"
                onClick={(e) => {
                  const rect = canvasRef.current.getBoundingClientRect();
                  const x = e.clientX - rect.left;
                  const y = e.clientY - rect.top;
                  
                  const centerX = rect.width / 2;
                  const centerY = isMobile ? rect.height / 3 : rect.height / 2;
                  const radius = isMobile ? 80 : 120;
                  
                  branches.forEach((branch, i) => {
                    const angle = (Math.PI * 2 * i) / branches.length - Math.PI / 2;
                    const bx = centerX + Math.cos(angle) * radius;
                    const by = centerY + Math.sin(angle) * radius;
                    
                    const distance = Math.sqrt((x - bx) ** 2 + (y - by) ** 2);
                    if (distance < 30) {
                      setSelectedBranch(branch);
                    }
                  });
                }}
              />

              {branches.length === 0 && (
                <div className="absolute inset-0 flex items-center justify-center">
                  <motion.div
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                    className="text-center p-6"
                  >
                    <p className="text-purple-200 mb-4 text-sm md:text-base">No options yet. Start by chatting with the AI!</p>
                    <button
                      onClick={addCustomBranch}
                      className="px-4 py-2 md:px-6 md:py-3 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-all text-sm md:text-base"
                    >
                      + Add Option Manually
                    </button>
                  </motion.div>
                </div>
              )}

              {branches.length > 0 && !isMobile && (
                <div className="absolute bottom-4 left-4 bg-black/40 backdrop-blur-xl rounded-lg p-3 border border-white/10">
                  <div className="flex items-center space-x-4 text-xs">
                    <div className="flex items-center space-x-2">
                      <div className="w-3 h-3 rounded-full bg-green-500"></div>
                      <span className="text-green-300">High Alignment</span>
                    </div>
                    <div className="flex items-center space-x-2">
                      <div className="w-3 h-3 rounded-full bg-orange-500"></div>
                      <span className="text-orange-300">Medium</span>
                    </div>
                    <div className="flex items-center space-x-2">
                      <div className="w-3 h-3 rounded-full bg-red-500"></div>
                      <span className="text-red-300">Low</span>
                    </div>
                  </div>
                </div>
              )}
            </div>

            <AnimatePresence>
              {selectedBranch && !isMobile && (
                <motion.div
                  initial={{ x: 300, opacity: 0 }}
                  animate={{ x: 0, opacity: 1 }}
                  exit={{ x: 300, opacity: 0 }}
                  className="w-80 bg-black/20 backdrop-blur-xl border-l border-white/10 p-6 overflow-y-auto"
                >
                  <div className="flex items-start justify-between mb-4">
                    <h3 className="text-white font-semibold text-lg flex-1">{selectedBranch.title}</h3>
                    <button
                      onClick={() => setSelectedBranch(null)}
                      className="text-purple-400 hover:text-white transition-colors"
                    >
                      ✕
                    </button>
                  </div>

                  <div className="space-y-4">
                    <div>
                      <p className="text-purple-300 text-sm mb-2">Alignment Score</p>
                      <div className="h-3 bg-white/10 rounded-full overflow-hidden">
                        <motion.div
                          initial={{ width: 0 }}
                          animate={{ width: `${calculateAlignment(selectedBranch) * 100}%` }}
                          transition={{ duration: 1, ease: 'easeOut' }}
                          className="h-full bg-gradient-to-r from-purple-500 to-pink-500"
                        />
                      </div>
                      <p className="text-right text-purple-400 text-sm mt-1">
                        {Math.round(calculateAlignment(selectedBranch) * 100)}%
                      </p>
                    </div>

                    <div>
                      <p className="text-purple-300 text-sm mb-2">Certainty</p>
                      <div className="flex items-center space-x-2">
                        <div className="flex-1 h-2 bg-white/10 rounded-full overflow-hidden">
                          <div
                            className="h-full bg-blue-500"
                            style={{ width: `${selectedBranch.probability * 100}%` }}
                          />
                        </div>
                        <span className="text-blue-400 text-sm font-mono">
                          {Math.round(selectedBranch.probability * 100)}%
                        </span>
                      </div>
                    </div>

                    <div>
                      <p className="text-purple-300 text-sm mb-2">Potential Outcomes</p>
                      <ul className="space-y-2">
                        {selectedBranch.outcomes.map((outcome, i) => (
                          <li key={i} className="text-purple-100 text-sm flex items-start">
                            <span className="text-purple-500 mr-2">•</span>
                            <span>{outcome}</span>
                          </li>
                        ))}
                      </ul>
                    </div>

                    <div>
                      <p className="text-purple-300 text-sm mb-3">Value Breakdown</p>
                      {values.map(value => {
                        const score = selectedBranch.valueScores?.[value.name] || 0.5;
                        return (
                          <div key={value.id} className="mb-2">
                            <div className="flex justify-between text-xs mb-1">
                              <span className="text-purple-200">{value.name}</span>
                              <span className="text-purple-400">{Math.round(score * 100)}%</span>
                            </div>
                            <div className="h-1.5 bg-white/10 rounded-full overflow-hidden">
                              <div
                                className="h-full transition-all duration-500"
                                style={{
                                  width: `${score * 100}%`,
                                  backgroundColor: value.color
                                }}
                              />
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </motion.div>
              )}
            </AnimatePresence>
          </div>

          <AnimatePresence>
            {selectedBranch && isMobile && (
              <motion.div
                initial={{ y: '100%' }}
                animate={{ y: 0 }}
                exit={{ y: '100%' }}
                className="fixed inset-x-0 bottom-0 bg-black/95 backdrop-blur-xl border-t border-white/10 p-6 rounded-t-3xl max-h-[70vh] overflow-y-auto"
              >
                <div className="flex items-start justify-between mb-4">
                  <h3 className="text-white font-semibold text-lg flex-1">{selectedBranch.title}</h3>
                  <button
                    onClick={() => setSelectedBranch(null)}
                    className="text-purple-400 hover:text-white transition-colors text-2xl"
                  >
                    ✕
                  </button>
                </div>

                <div className="space-y-4">
                  <div>
                    <p className="text-purple-300 text-sm mb-2">Alignment: {Math.round(calculateAlignment(selectedBranch) * 100)}%</p>
                    <div className="h-3 bg-white/10 rounded-full overflow-hidden">
                      <div
                        className="h-full bg-gradient-to-r from-purple-500 to-pink-500"
                        style={{ width: `${calculateAlignment(selectedBranch) * 100}%` }}
                      />
                    </div>
                  </div>

                  <div>
                    <p className="text-purple-300 text-sm mb-2">Outcomes</p>
                    <ul className="space-y-2">
                      {selectedBranch.outcomes.map((outcome, i) => (
                        <li key={i} className="text-purple-100 text-sm">• {outcome}</li>
                      ))}
                    </ul>
                  </div>
                </div>
              </motion.div>
            )}
          </AnimatePresence>

          <AnimatePresence>
            {showChat && (
              <motion.div
                initial={{ y: '100%' }}
                animate={{ y: 0 }}
                exit={{ y: '100%' }}
                transition={{ type: 'spring', damping: 25, stiffness: 200 }}
                className="fixed inset-x-0 bottom-0 md:right-0 md:left-auto md:w-96 bg-black/95 backdrop-blur-xl border-t md:border-l border-white/10 flex flex-col"
                style={{ height: isMobile ? '60vh' : '100vh' }}
              >
                <div className="bg-purple-600/20 p-4 border-b border-white/10 flex items-center justify-between">
                  <h3 className="text-white font-semibold">AI Decision Coach</h3>
                  <button
                    onClick={() => setShowChat(false)}
                    className="text-purple-400 hover:text-white transition-colors"
                  >
                    ✕
                  </button>
                </div>

                <div className="flex-1 overflow-y-auto p-4 space-y-4">
                  {messages.map((msg, i) => (
                    <motion.div
                      key={i}
                      initial={{ opacity: 0, y: 10 }}
                      animate={{ opacity: 1, y: 0 }}
                      className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}
                    >
                      <div
                        className={`max-w-[85%] px-4 py-3 rounded-2xl ${
                          msg.role === 'user'
                            ? 'bg-purple-600 text-white'
                            : 'bg-white/10 text-purple-100'
                        }`}
                      >
                        <p className="text-sm whitespace-pre-wrap">{msg.content}</p>
                      </div>
                    </motion.div>
                  ))}
                  {isAiThinking && (
                    <motion.div
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      className="flex justify-start"
                    >
                      <div className="bg-white/10 px-4 py-3 rounded-2xl">
                        <div className="flex space-x-2">
                          <div className="w-2 h-2 bg-purple-400 rounded-full animate-bounce" style={{ animationDelay: '0ms' }}></div>
                          <div className="w-2 h-2 bg-purple-400 rounded-full animate-bounce" style={{ animationDelay: '150ms' }}></div>
                          <div className="w-2 h-2 bg-purple-400 rounded-full animate-bounce" style={{ animationDelay: '300ms' }}></div>
                        </div>
                      </div>
                    </motion.div>
                  )}
                  <div ref={chatEndRef} />
                </div>

                <div className="p-4 border-t border-white/10">
                  <div className="flex space-x-2">
                    <input
                      type="text"
                      value={inputMessage}
                      onChange={(e) => setInputMessage(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                      placeholder="Ask for guidance..."
                      className="flex-1 px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-purple-300/50 focus:outline-none focus:border-purple-400 text-sm"
                      disabled={isAiThinking}
                    />
                    <button
                      onClick={sendMessage}
                      disabled={isAiThinking || !inputMessage.trim()}
                      className="px-4 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-600/50 text-white rounded-xl font-medium transition-all"
                    >
                      Send
                    </button>
                  </div>
                </div>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<DecisionVisualizer />);
  </script>
</body>
</html>
